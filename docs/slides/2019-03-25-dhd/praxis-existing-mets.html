<!DOCTYPE html>
<html lang="de"><head>
  <meta charset="utf-8"/>
  <title> - OCR-D</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="shortcut icon" href="https://avatars0.githubusercontent.com/u/26362587?s=200&amp;v=4" />
  <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous" />
  <link rel="alternate" type="application/atom+xml" title="OCR-D Blog" href="/feed.xml" />
  <link rel="stylesheet" href="/assets/bulma.css" />
  <link rel="stylesheet" href="/assets/bulma-switch.min.css" />
  <link rel="stylesheet" href="/assets/syntax-highlight.css" />
  <link rel="stylesheet" href="/assets/ocrd.css" />
</head>
<body><nav class="navbar is-transparent is-fixed-top">

  <div class="navbar-brand">
    <a class="navbar-item" href="/">
      <img src="/assets/ocrd-logo-small.png" height="28"/>
    </a>
    <div class="navbar-burger burger" data-target="ocrd-navbar-menu">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </div>

  <div id="ocrd-navbar-menu" class="navbar-menu">
    <div class="navbar-start">
      
      
      <div class="navbar-item has-dropdown is-hoverable">
        <a class="navbar-link" href="/de/">Über</a>
        <div class="navbar-dropdown">
          

          
          

            
            <a class="navbar-item" href="/de/blog">Aktuelles</a>

          

          

          
          

            
            <a class="navbar-item" href="/de/about">Über das OCR-D-Projekt</a>

          

          

          
          

            
            <a class="navbar-item" href="/de/phase2">Phase II: Projekte</a>

          

          

          
          

            
            <a class="navbar-item" href="/de/phase3">Phase III: Projekte</a>

          

          

          
          

            
            <a class="navbar-item" href="/de/contact">Kontaktieren Sie uns!</a>

          

          

          
          

            
            <a class="navbar-item" href="/de/platforms">Community</a>

          

          

          
          

            
            <a class="navbar-item" href="/de/publications">Publikationen und Vorträge</a>

          

          

          
          

            
            <a class="navbar-item" href="/de/data">Daten</a>

          

          

          
          
            
            
              
              <a class="navbar-item" href="/de/teststellung">Pilotstudie</a>
            

          

          

          
          

            
            <a class="navbar-item" href="/de/user_survey">Nutzer*innenumfrage</a>

          

          

          
          
            
            
              
              <a class="navbar-item" href="/de/impressum">Impressum</a>
            

          

          
        </div>
      </div>
      
      
      
      <div class="navbar-item has-dropdown is-hoverable">
        <a class="navbar-link" href="/de/dev">Technische Dokumentation</a>
        <div class="navbar-dropdown">
          

          
          

            
            <a class="navbar-item" href="/de/gt-guidelines/trans">Ground Truth Richtlinien</a>

          

          

          
          

            
            <a class="navbar-item" href="/de/gt-guidelines/trans/trPage">PAGE-XML Formatdokumentation</a>

          

          

          
          

            
            <a class="navbar-item" href="/en/dev-best-practice">Best Practices für Softwareentwicklung in OCR-D</a>

          

          

          
          

            
            <a class="navbar-item" href="/de/spec">Spezifikationen</a>

          

          

          
          

            
            <a class="navbar-item" href="/core">OCR-D/core API Dokumentation</a>

          

          
        </div>
      </div>
      
      
      
      <div class="navbar-item has-dropdown is-hoverable">
        <a class="navbar-link" href="/de/use">Nutzungsinformationen und Anleitungen</a>
        <div class="navbar-dropdown">
          

          
          
            
            
              <a class="navbar-item" href="https://translate.google.com/translate?hl=&sl=en&tl=de&u=https%3A%2F%2Focr-d.de%2Fen%2Fsetup">Setup Anleitung</a>
            

          

          

          
          
            
            
              <a class="navbar-item" href="https://translate.google.com/translate?hl=&sl=en&tl=de&u=https%3A%2F%2Focr-d.de%2Fen%2Fuser_guide">Nutzeranleitung</a>
            

          

          

          
          
            
            
              <a class="navbar-item" href="https://translate.google.com/translate?hl=&sl=en&tl=de&u=https%3A%2F%2Focr-d.de%2Fen%2Fworkflows">Workflows</a>
            

          

          

          
          

            
            <a class="navbar-item" href="/en/models">Modelle</a>

          

          

          
          

            
            <a class="navbar-item" href="/de/spec/glossary">Glossar</a>

          

          
        </div>
      </div>
      
      
      
        <a class="navbar-item" href="/de/faq">FAQ</a>
      
      

    </div>

    <div class="navbar-end">

      <span class="navbar-item">
          
      </span>

    </div> </div> </nav>
<div class="columns">
      
      <aside id="toc-sidebar-content" class="column is-one-third menu is-hidden-mobile">
        <ul class="menu-list column is-one-third">
  <li><a href="#praxis-ocr-von-digitalisierten-beständen">Praxis: OCR von digitalisierten Beständen</a>
    <ul>
      <li><a href="#ist-ocrd-installiert">Ist <code class="highlighter-rouge">ocrd</code> installiert?</a></li>
      <li><a href="#mets-herunterladen">METS herunterladen</a></li>
      <li><a href="#mets-untersuchen">METS untersuchen</a>
        <ul>
          <li><a href="#welche-dateigruppen-gibt-es">Welche Dateigruppen gibt es?</a></li>
          <li><a href="#welche-seiten-gibt-es">Welche Seiten gibt es?</a></li>
          <li><a href="#dateien-auflisten">Dateien auflisten</a></li>
        </ul>
      </li>
      <li><a href="#anatomie-eines-ocrd--kommandozeilenaufrufs">Anatomie eines <code class="highlighter-rouge">ocrd-*</code> Kommandozeilenaufrufs</a></li>
      <li><a href="#binarisierung-mit-ocrd-kraken-binarize">Binarisierung mit <code class="highlighter-rouge">ocrd-kraken-binarize</code></a></li>
      <li><a href="#zeilensegmentierung-mit-ocropy">Zeilensegmentierung mit Ocropy</a></li>
      <li><a href="#texterkennung-mit-tesseract">Texterkennung mit tesseract</a></li>
      <li><a href="#in-einem-rutsch">“In einem Rutsch”</a></li>
      <li><a href="#aufgabe">Aufgabe</a></li>
    </ul>
  </li>
</ul>

      </aside>
      <div id="toc-sidebar-toggle">&lt;&gt;</div>
      

      <main class="container content column is-two-thirds" aria-label="Content">
        <h1 id="praxis-ocr-von-digitalisierten-beständen">Praxis: OCR von digitalisierten Beständen</h1>

<p>Der Einfachheit halber verwenden wir ein Beispiel aus dem <a href="https://github.com/OCR-D/assets">Bestand an Testdaten
innerhalb von OCR-D</a>, da diese weniger umfangreich
sind. Prinzipiell funktionieren die OCR-D Werkzeuge aber mit allen METS-Dateien, die
auch im DFG-Viewer angezeigt werden können.</p>

<h2 id="ist-ocrd-installiert">Ist <code class="highlighter-rouge">ocrd</code> installiert?</h2>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ocrd <span class="nt">--help</span>
Usage: ocrd <span class="o">[</span>OPTIONS] COMMAND <span class="o">[</span>ARGS]...

  CLI to OCR-D

Options:
  <span class="nt">--version</span>                       Show the version and exit.
  <span class="nt">-l</span>, <span class="nt">--log-level</span> <span class="o">[</span>OFF|ERROR|WARN|INFO|DEBUG|TRACE]
                                  Log level
  <span class="nt">--help</span>                          Show this message and exit.

Commands:
  bashlib    Work with bash library
  ocrd-tool  Work with ocrd-tool.json JSON_FILE
  process    Process a series of tasks
  workspace  Working with workspace
  zip        Bag/Spill/Validate OCRD-ZIP bags
</code></pre></div></div>

<p>Falls dieser Befehl nicht klappt, überprüfen Sie ob die <a href="./setup-time">Software richtig installiert wurde</a>.</p>

<h2 id="mets-herunterladen">METS herunterladen</h2>

<p>Wir verwenden eine auf 2 Seiten reduzierte Erstausgabe von Kant “Kritik der reinen Vernunft” aus dem Bestand
des Deutschen Textarchivs, die in GitHub liegt: https://github.com/OCR-D/assets/blob/master/data/kant_aufklaerung_1784/data/mets.xml</p>

<p>Dazu nutze den <code class="highlighter-rouge">workspace</code> Unterbefehl von <code class="highlighter-rouge">ocrd</code>, der es erlaubt, mit METS zu
interagieren, ohne das XML direkt bearbeiten zu müssen.</p>

<p>Der Unterbefehl <code class="highlighter-rouge">clone</code> erlaubt das Herunterladen von METS und ggf. enthaltenen Dateien.</p>

<p>Mit dem Parameter <code class="highlighter-rouge">--download</code> werden auch alle referenzierten Dateien mit heruntergeladen (das entfernte Verzeichnis wird “geklont”)</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ocrd workspace clone <span class="nt">--download</span> <span class="s2">"https://raw.githubusercontent.com/OCR-D/assets/master/data/kant_aufklaerung_1784/data/mets.xml"</span> kant
20:47:48.914 INFO ocrd.workspace - Saving mets <span class="s1">'/home/kba/build/github.com/OCR-D/monorepo/slides/2019-03-25-dhd/kant/mets.xml'</span>
/home/ich/kant

<span class="nv">$ </span>find kant
kant
kant/OCR-D-IMG
kant/OCR-D-IMG/INPUT_0017
kant/OCR-D-IMG/INPUT_0020
kant/OCR-D-GT-ALTO
kant/OCR-D-GT-ALTO/PAGE_0020_ALTO
kant/OCR-D-GT-ALTO/PAGE_0017_ALTO
kant/OCR-D-GT-PAGE
kant/OCR-D-GT-PAGE/PAGE_0017_PAGE
kant/OCR-D-GT-PAGE/PAGE_0020_PAGE
kant/mets.xml
</code></pre></div></div>

<p>Das METS liegt nun als <code class="highlighter-rouge">mets.xml</code> im Unterverzeichnis <code class="highlighter-rouge">kant</code>, die Bilder in
Unterverzeichnissen, die Dateigruppen repräsentieren.</p>

<p><strong>TIPP</strong> Kopieren sie das geklonte Verzeichnis an diesem Punkt. Dann müssen Sie nicht
alle Dateien neu laden, falls im weiteren Ablauf etwas schief läuft:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cp</span> <span class="nt">-r</span> kant kant.BAK
</code></pre></div></div>

<h2 id="mets-untersuchen">METS untersuchen</h2>

<p>Die METS-Datei könenn wir nun untersuchen.</p>

<h3 id="welche-dateigruppen-gibt-es">Welche Dateigruppen gibt es?</h3>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd </span>kant
<span class="nv">$ </span>ocrd workspace list-group
OCR-D-IMG
OCR-D-GT-PAGE
OCR-D-GT-ALTO
</code></pre></div></div>

<p>Es gibt also drei Dateigruppen, wobei wir uns für die Bilder interessieren, die in <code class="highlighter-rouge">OCR-D-IMG</code> gelistet sind.</p>

<h3 id="welche-seiten-gibt-es">Welche Seiten gibt es?</h3>

<p>Physische Seiten werden in METS in einer <code class="highlighter-rouge">structMap</code> aufgelistet. Wir können uns die IDs der Seiten ausgeben lassen:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ocrd workspace list-page
PHYS_0017
PHYS_0020
</code></pre></div></div>

<p>Es gibt zwei Seiten.</p>

<h3 id="dateien-auflisten">Dateien auflisten</h3>

<p>Wir können uns die enthaltenen Dateien auflisten lassen mit dem <code class="highlighter-rouge">find</code> Unterbefehl:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ocrd workspace find
OCR-D-IMG/INPUT_0017
OCR-D-IMG/INPUT_0020
OCR-D-GT-PAGE/PAGE_0017_PAGE
OCR-D-GT-PAGE/PAGE_0020_PAGE
OCR-D-GT-ALTO/PAGE_0017_ALTO
OCR-D-GT-ALTO/PAGE_0020_ALTO
</code></pre></div></div>

<p>Es gibt sechs Dateien: Für jede der zwei Seiten Dateien für jede der drei Dateigruppen.</p>

<p>Standardmäßig wird nur die Datei-ID ausgegeben, weitere Felder können über den
Parameter <code class="highlighter-rouge">-k</code> angegeben werden (<code class="highlighter-rouge">ocrd workspace find --help</code> liefert weitere
Informationen):</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ocrd workspace find <span class="nt">-k</span> url <span class="nt">-k</span> mimetype <span class="nt">-k</span> pageId <span class="nt">-k</span> ID
OCR-D-IMG/INPUT_0017    image/tiff      PHYS_0017       INPUT_0017
OCR-D-IMG/INPUT_0020    image/tiff      PHYS_0020       INPUT_0020
OCR-D-GT-PAGE/PAGE_0017_PAGE    application/vnd.prima.page+xml  PHYS_0017       PAGE_0017_PAGE
OCR-D-GT-PAGE/PAGE_0020_PAGE    application/vnd.prima.page+xml  PHYS_0020       PAGE_0020_PAGE
OCR-D-GT-ALTO/PAGE_0017_ALTO    application/alto+xml    PHYS_0017       PAGE_0017_ALTO
OCR-D-GT-ALTO/PAGE_0020_ALTO    application/alto+xml    PHYS_0020       PAGE_0020_ALTO
</code></pre></div></div>

<!-- ## Herunterladen der Bild-Dateien -->

<!-- Prinzipiell kann `ocrd` auch mit entfernten Bildern arbeiten.  -->

<h2 id="anatomie-eines-ocrd--kommandozeilenaufrufs">Anatomie eines <code class="highlighter-rouge">ocrd-*</code> Kommandozeilenaufrufs</h2>

<p>Alle OCR-D Werkzeuge folgen einer einheitlichen Aufrufsyntax, die <a href="https://ocr-d.github.io/cli">Teil der
Spezifikationen ist</a>.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ocrd-<span class="k">*</span> <span class="se">\</span>
  <span class="nt">-m</span> mets.xml         <span class="se">\ </span><span class="c"># Pfad zur METS-Datei</span>
  <span class="nt">-I</span> INPUT-GROUP      <span class="se">\ </span><span class="c"># Eingabe-Dateigruppe</span>
  <span class="nt">-O</span> OUTPUT-GROUP     <span class="se">\ </span><span class="c"># Ausgabe-Dateigruppe</span>
  <span class="nt">-l</span> DEBUG|INFO|ERROR <span class="se">\ </span><span class="c"># Optional: Logging Detail Level</span>
  <span class="nt">-p</span> parameter.json   <span class="se">\ </span><span class="c"># Optional: Parameter-Datei</span>
  <span class="nt">-g</span> PAGE-ID          <span class="se">\ </span><span class="c"># Optional: ID einer Seite falls nur eine Seite verarbeitet werden soll</span>
</code></pre></div></div>

<h2 id="binarisierung-mit-ocrd-kraken-binarize">Binarisierung mit <code class="highlighter-rouge">ocrd-kraken-binarize</code></h2>

<p>Der erste Schritt für die OCR ist die Binarisierung des Bildes, bei der alle
Farben durch schwarz oder weiss ersetzt werden.</p>

<p>Dafür gibt es verschiedene Implementierungen im OCR-D-Ökosystem, wir verwenden
hier die Binarisierung von kraken.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ocrd-kraken-binarize <span class="nt">-m</span> mets.xml <span class="nt">-I</span> OCR-D-IMG <span class="nt">-O</span> OCR-D-IMG-BIN
19:49:28.847 INFO processor.KrakenBinarize - INPUT FILE 0 / &lt;OcrdFile <span class="nv">mimetype</span><span class="o">=</span>image/tiff, <span class="nv">ID</span><span class="o">=</span>INPUT_0017, <span class="nv">url</span><span class="o">=</span>OCR-D-IMG/INPUT_0017, <span class="nv">local_filename</span><span class="o">=</span><span class="nt">---</span><span class="o">]</span>/&gt;
19:49:28.868 INFO processor.KrakenBinarize - pcgts &lt;ocrd_models.ocrd_page_generateds.PcGtsType object at 0x7effeb96aeb8&gt;
19:49:28.868 INFO processor.KrakenBinarize - About to binarize page <span class="s1">'None'</span>
19:49:28.871 INFO kraken.binarization - Binarizing /home/kba/build/github.com/OCR-D/monorepo/slides/2019-03-25-dhd/kant/OCR-D-IMG/INPUT_0017
19:49:32.928 INFO processor.KrakenBinarize - INPUT FILE 1 / &lt;OcrdFile <span class="nv">mimetype</span><span class="o">=</span>image/tiff, <span class="nv">ID</span><span class="o">=</span>INPUT_0020, <span class="nv">url</span><span class="o">=</span>OCR-D-IMG/INPUT_0020, <span class="nv">local_filename</span><span class="o">=</span><span class="nt">---</span><span class="o">]</span>/&gt;
19:49:32.931 INFO processor.KrakenBinarize - pcgts &lt;ocrd_models.ocrd_page_generateds.PcGtsType object at 0x7effeb8ac5f8&gt;
19:49:32.931 INFO processor.KrakenBinarize - About to binarize page <span class="s1">'None'</span>
19:49:32.933 INFO kraken.binarization - Binarizing /home/kba/build/github.com/OCR-D/monorepo/slides/2019-03-25-dhd/kant/OCR-D-IMG/INPUT_0020
19:49:36.986 INFO ocrd.workspace - Saving mets <span class="s1">'/home/kba/build/github.com/OCR-D/monorepo/slides/2019-03-25-dhd/kant/mets.xml'</span>
</code></pre></div></div>

<p>Damit werden alle Dateien in der <code class="highlighter-rouge">OCR-D-IMG</code> Dateigruppe binarisiert, das
Ergebnis wird in die Dateigruppe <code class="highlighter-rouge">OCR-D-IMG-BIN</code> geschrieben.</p>

<h2 id="zeilensegmentierung-mit-ocropy">Zeilensegmentierung mit Ocropy</h2>

<p>Als nächsten Schritt müssen die Zeilen bestimmt werden, damit OCR angewandt werden kann.</p>

<p>Auch dafür gibt es verschiedene Implementierungen innerhalb von OCR-D, wir verwenden die Zeilensegmentierung von Ocropus.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ocrd-ocropy-segment <span class="nt">-m</span> mets.xml <span class="nt">-I</span> OCR-D-IMG-BIN <span class="nt">-O</span> OCR-D-SEG-LINE
19:52:45.364 INFO processor.ocropySegment - INPUT FILE 0 / &lt;OcrdFile <span class="nv">mimetype</span><span class="o">=</span>image/png, <span class="nv">ID</span><span class="o">=</span>OCR-D-IMG-BIN_0001, <span class="nv">url</span><span class="o">=</span>OCR-D-IMG-BIN/OCR-D-IMG-BIN_0001, <span class="nv">local_filename</span><span class="o">=</span><span class="nt">---</span><span class="o">]</span>/&gt;
19:52:45.365 INFO processor.ocropySegment - downloaded_file &lt;OcrdFile <span class="nv">mimetype</span><span class="o">=</span>image/png, <span class="nv">ID</span><span class="o">=</span>OCR-D-IMG-BIN_0001, <span class="nv">url</span><span class="o">=</span>OCR-D-IMG-BIN/OCR-D-IMG-BIN_0001, <span class="nv">local_filename</span><span class="o">=</span>/home/kba/build/github.com/OCR-D/monorepo/slides/2019-03-25-dhd/kant/OCR-D-IMG-BIN/OCR-D-IMG-BIN_0001]/&gt;
19:52:45.383 INFO processor.ocropySegment - pcgts &lt;ocrd_models.ocrd_page_generateds.PcGtsType object at 0x7fcf0fab2208&gt;
19:52:50.705 INFO processor.ocropySegment - INPUT FILE 1 / &lt;OcrdFile <span class="nv">mimetype</span><span class="o">=</span>image/png, <span class="nv">ID</span><span class="o">=</span>OCR-D-IMG-BIN_0002, <span class="nv">url</span><span class="o">=</span>OCR-D-IMG-BIN/OCR-D-IMG-BIN_0002, <span class="nv">local_filename</span><span class="o">=</span><span class="nt">---</span><span class="o">]</span>/&gt;
19:52:50.705 INFO processor.ocropySegment - downloaded_file &lt;OcrdFile <span class="nv">mimetype</span><span class="o">=</span>image/png, <span class="nv">ID</span><span class="o">=</span>OCR-D-IMG-BIN_0002, <span class="nv">url</span><span class="o">=</span>OCR-D-IMG-BIN/OCR-D-IMG-BIN_0002, <span class="nv">local_filename</span><span class="o">=</span>/home/kba/build/github.com/OCR-D/monorepo/slides/2019-03-25-dhd/kant/OCR-D-IMG-BIN/OCR-D-IMG-BIN_0002]/&gt;
19:52:50.706 INFO processor.ocropySegment - pcgts &lt;ocrd_models.ocrd_page_generateds.PcGtsType object at 0x7fcf0fa66358&gt;
19:52:55.739 INFO ocrd.workspace - Saving mets <span class="s1">'/home/kba/build/github.com/OCR-D/monorepo/slides/2019-03-25-dhd/kant/mets.xml'</span>
</code></pre></div></div>

<p>Ausgehend von den binarisierten Bilder in der Dateigruppe <code class="highlighter-rouge">OCR-D-IMG-BIN</code> erzeugen wir PAGE-XML mit Segmentierungsinformation in der Dateigruppe und dem lokalen Verzeichnis <code class="highlighter-rouge">OCR-D-SEG-LINE</code>.</p>

<p>Das PAGE-XML sieht ausschnittsweise so aus:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;pc:Page</span> <span class="na">imageFilename=</span><span class="s">"OCR-D-IMG-BIN/OCR-D-IMG-BIN_0002"</span> <span class="na">imageWidth=</span><span class="s">"1456"</span> <span class="na">imageHeight=</span><span class="s">"2084"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;pc:TextRegion&gt;</span>
        <span class="nt">&lt;pc:TextLine</span> <span class="na">id=</span><span class="s">"line_0002"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;pc:Coords</span> <span class="na">points=</span><span class="s">"103,136 122,136 122,188 103,188"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/pc:TextLine&gt;</span>
        <span class="nt">&lt;pc:TextLine</span> <span class="na">id=</span><span class="s">"line_0003"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;pc:Coords</span> <span class="na">points=</span><span class="s">"126,125 166,125 166,185 126,185"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/pc:TextLine&gt;</span>
        <span class="nt">&lt;pc:TextLine</span> <span class="na">id=</span><span class="s">"line_0004"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;pc:Coords</span> <span class="na">points=</span><span class="s">"166,124 209,124 209,168 166,168"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/pc:TextLine&gt;</span>
      <span class="c">&lt;!-- ... --&gt;</span>
</code></pre></div></div>

<p>Wir können uns das Ergebnis auch im PAGE Viewer visualisieren:</p>

<p><img src="/2019-03-25-dhd/figures/page-viewer.png" alt="" /></p>

<p>Die Zeilenerkennung ist nicht perfekt (Artefakte im Randbereich, ueberlange
Zeilen), aber gut genug, um OCR durchzuführen.</p>

<h2 id="texterkennung-mit-tesseract">Texterkennung mit tesseract</h2>

<p>Das Projekt <code class="highlighter-rouge">ocrd_tesserocr</code> bindet tesseract über die <code class="highlighter-rouge">tesserocr</code>
Python-Bindings an OCR-D an.</p>

<p>Der Aufruf ist analog zu Binarisierung und Segmentierung:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ocrd-tesserocr-recognize <span class="nt">-m</span> mets.xml <span class="nt">-I</span> OCR-D-SEG-LINE <span class="nt">-O</span> OCR-D-OCR-TESS
21:09:52.910 INFO processor.TesserocrRecognize - Using model <span class="s1">'eng'</span> <span class="k">in</span> /usr/share/tesseract-ocr/4.00/tessdata/ <span class="k">for </span>recognition at the line level
21:09:52.910 INFO processor.TesserocrRecognize - INPUT FILE 0 / &lt;OcrdFile <span class="nv">mimetype</span><span class="o">=</span>application/vnd.prima.page+xml, <span class="nv">ID</span><span class="o">=</span>OCR-D-SEG-LINE_0001, <span class="nv">url</span><span class="o">=</span>OCR-D-SEG-LINE/
OCR-D-SEG-LINE_0001.xml, <span class="nv">local_filename</span><span class="o">=</span><span class="nt">---</span><span class="o">]</span>/&gt;
21:09:53.071 INFO processor.TesserocrRecognize - Recognizing text <span class="k">in </span>page <span class="s1">'None'</span>
21:10:24.127 INFO processor.TesserocrRecognize - INPUT FILE 1 / &lt;OcrdFile <span class="nv">mimetype</span><span class="o">=</span>application/vnd.prima.page+xml, <span class="nv">ID</span><span class="o">=</span>OCR-D-SEG-LINE_0002, <span class="nv">url</span><span class="o">=</span>OCR-D-SEG-LINE/
OCR-D-SEG-LINE_0002.xml, <span class="nv">local_filename</span><span class="o">=</span><span class="nt">---</span><span class="o">]</span>/&gt;
21:10:24.357 INFO processor.TesserocrRecognize - Recognizing text <span class="k">in </span>page <span class="s1">'None'</span>
21:11:09.617 INFO ocrd.workspace - Saving mets <span class="s1">'/home/kba/build/github.com/OCR-D/monorepo/slides/2019-03-25-dhd/kant/mets.xml'</span>
</code></pre></div></div>

<p>Das Ergebnis ist allerdings nicht optimal. Ausschnitt aus <code class="highlighter-rouge">kant/OCR-D-OCR-TESS/OCR-D-OCR-TESS_0002</code>:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nt">&lt;pc:TextLine</span> <span class="na">id=</span><span class="s">"line_0006"</span><span class="nt">&gt;</span>
     <span class="nt">&lt;pc:Coords</span> <span class="na">points=</span><span class="s">"529,410 1342,410 1342,468 529,468"</span><span class="nt">/&gt;</span>
     <span class="nt">&lt;pc:TextEquiv</span> <span class="na">conf=</span><span class="s">"0.47"</span><span class="nt">&gt;</span>
         <span class="nt">&lt;pc:Unicode&gt;</span>geenegerc wogpe35tro rappucb धाम es Bgrenbeire ﺪﺷﺭ<span class="nt">&lt;/pc:Unicode&gt;</span>
     <span class="nt">&lt;/pc:TextEquiv&gt;</span>
 <span class="nt">&lt;/pc:TextLine&gt;</span>
</code></pre></div></div>

<p>Das liegt daran, dass wir nicht angegeben haben, welches Modell verwendet werden soll. Standardmäßig verwendet
tesseract daher <code class="highlighter-rouge">eng</code>, das Modell für englischsprachige Antiqua. Für deutsche Fraktur benötigen wir das
Modell <code class="highlighter-rouge">frk</code>, das im <a href="https://github.com/tesseract-ocr/tessdata_best">tesseract-Modell-GitHub-Repository</a> zu finden ist.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd</span> /usr/share/tesseract-ocr/4.00/tessdata/
<span class="nv">$ </span><span class="nb">sudo </span>wget <span class="s1">'https://github.com/tesseract-ocr/tessdata_best/raw/master/frk.traineddata'</span>
</code></pre></div></div>

<p>Nun führen wir den befehl noch einmal aus aber geben als Parameter das zu verwendende Modell mit an:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ocrd-tesserocr-recognize <span class="nt">-m</span> mets.xml <span class="nt">-I</span> OCR-D-SEG-LINE <span class="nt">-O</span> OCR-D-OCR-TESS-FRK <span class="nt">-p</span> &lt;<span class="o">(</span><span class="nb">echo</span> <span class="s1">'{"model": "frk"}'</span><span class="o">)</span>
21:09:52.910 INFO processor.TesserocrRecognize - Using model <span class="s1">'frk'</span> <span class="k">in</span> /usr/share/tesseract-ocr/4.00/tessdata/ <span class="k">for </span>recognition at the line level
21:09:52.910 INFO processor.TesserocrRecognize - INPUT FILE 0 / &lt;OcrdFile <span class="nv">mimetype</span><span class="o">=</span>application/vnd.prima.page+xml, <span class="nv">ID</span><span class="o">=</span>OCR-D-SEG-LINE_0001, <span class="nv">url</span><span class="o">=</span>OCR-D-SEG-LINE/
OCR-D-SEG-LINE_0001.xml, <span class="nv">local_filename</span><span class="o">=</span><span class="nt">---</span><span class="o">]</span>/&gt;
21:09:53.071 INFO processor.TesserocrRecognize - Recognizing text <span class="k">in </span>page <span class="s1">'None'</span>
21:10:24.127 INFO processor.TesserocrRecognize - INPUT FILE 1 / &lt;OcrdFile <span class="nv">mimetype</span><span class="o">=</span>application/vnd.prima.page+xml, <span class="nv">ID</span><span class="o">=</span>OCR-D-SEG-LINE_0002, <span class="nv">url</span><span class="o">=</span>OCR-D-SEG-LINE/
OCR-D-SEG-LINE_0002.xml, <span class="nv">local_filename</span><span class="o">=</span><span class="nt">---</span><span class="o">]</span>/&gt;
21:10:24.357 INFO processor.TesserocrRecognize - Recognizing text <span class="k">in </span>page <span class="s1">'None'</span>
21:11:09.617 INFO ocrd.workspace - Saving mets <span class="s1">'/home/kba/build/github.com/OCR-D/monorepo/slides/2019-03-25-dhd/kant/mets.xml'</span>
</code></pre></div></div>

<p>Vergleichen wir die Erkennung der Textzeile:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;pc:TextLine</span> <span class="na">id=</span><span class="s">"line_0006"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;pc:Coords</span> <span class="na">points=</span><span class="s">"529,410 1342,410 1342,468 529,468"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;pc:TextEquiv</span> <span class="na">conf=</span><span class="s">"0.9"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;pc:Unicode&gt;</span>gewiegelt worden ; ſo ſchädlich iſt es Vorurtheile zu<span class="nt">&lt;/pc:Unicode&gt;</span>
    <span class="nt">&lt;/pc:TextEquiv&gt;</span>
<span class="nt">&lt;/pc:TextLine&gt;</span>
</code></pre></div></div>

<p>Das sieht nicht nur korrekt aus, auch tesseract ist sich sicherer: Konfidenz <code class="highlighter-rouge">0.9.</code> vs <code class="highlighter-rouge">0.47</code> oben.</p>

<h2 id="in-einem-rutsch">“In einem Rutsch”</h2>

<p>Die einzelnen Prozessschritte nacheinander auszuführen wie beschrieben ist mühselig. Wenn an einem
Punkt im Ablauf etwas schief läuft, muss der gesamte Vorgang abgebrochen werden. Daher bietet <code class="highlighter-rouge">ocrd</code>
einen Modus, in dem ein kompletter Ablauf von Prozesschritten angegeben werden kann. Wenn innerhalb
des Prozesses ein Fehler auftritt, endet der Gesamtprozess mit der Fehlermeldung.</p>

<p>Die Syntax entsprocht weitgehend dem individuellen Aufruf mit der Einschränkung dass <code class="highlighter-rouge">ocrd-</code> weggelassen
wird:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ocrd process <span class="nt">-m</span> mets.xml <span class="se">\</span>
  <span class="s1">'kraken-binarize -I OCR-D-IMG -O OCR-D-IMG-BIN'</span> <span class="se">\</span>
  <span class="s1">'ocropy-segment -I OCR-D-IMG-BIN -O OCR-D-SEG-LINE'</span> <span class="se">\</span>
  <span class="s1">'tesserocr-recognize -I OCR-D-SEG-LINE -O OCR-D-OCR-TESS'</span>
</code></pre></div></div>

<h2 id="aufgabe">Aufgabe</h2>

<p>Wenden Sie die gelernten Schritte an auf die erste Seite des Kommunistischen Manifests.
Die URL der METS-Datei: <a href="https://raw.githubusercontent.com/OCR-D/assets/master/data/communist_manifesto/data/mets.xml">https://raw.githubusercontent.com/OCR-D/assets/master/data/communist_manifesto/data/mets.xml</a></p>

<p>Falls Sie Python 3.7 verwenden und deshalb ocrd_kraken nicht installieren konnten: Hier ist ein OCRD-ZIP
der Aufgabe bis einschliesslich Binarisierung: <a href="/2019-03-25-dhd/binarized.zip">binarized.zip</a></p>

      </main>
    </div><footer class="footer" style="padding: 1rem">
    <div class="content has-text-centered">
      <img class="footer-logo" src="/assets/dfg_logo_ger.jpg" alt="DFG logo"/>
    </div>
    <!-- <div class="content has-text-centered"> -->
    <!--   <img class="footer-logo" src="/assets/logo-bbaw.png" alt="BBAW logo"/> -->
    <!--   <img class="footer-logo" src="/assets/logo-hab.gif" alt="HAB logo"/> -->
    <!--   <img class="footer-logo" src="/assets/logo-kit.png" alt="KIT logo"/> -->
    <!--   <img class="footer-logo" src="/assets/logo-sbb.png" alt="SBB logo"/> -->
    <!-- </div> -->
    <div class="content has-text-centered">
      <a href="https://github.com/OCR-D">GitHub</a>
      |
      <a href="https://gitter.im/OCR-D/Lobby">gitter</a>
      |
      <a href="https://github.com/OCR-D/ocrd-website/wiki">Wiki</a>
      |
      <a href="https://hub.docker.com/u/ocrd">Docker Hub</a>
      |
      <a href="https://www.zotero.org/groups/418719/ocr-d">Technology Watch</a>
      |
      <a href="/sitemap.xml">sitemap.xml</a>
    </div>

<script src="/assets/script.js"></script>
</footer>
</body>

</html>
