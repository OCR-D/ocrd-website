<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="shortcut icon" href="https://avatars0.githubusercontent.com/u/26362587?s=200&amp;v=4"></link>
  <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
  <link rel="stylesheet" href="/assets/bulma.css"></link>
  <link rel="stylesheet" href="/assets/syntax-highlight.css"></link>
  <style>
  #swagger-ui pre.version {
    padding: 2px !important;
    background: initial !important;
  }
  #swagger-ui .topbar {
    display: none;
  }
  blockquote {
    background: #f99;
  }
  aside.menu > ul { 
    position: fixed;
    overflow-y: auto;
    height: calc(100vh - 150px);
  }
  body > #swagger-ui,
  body > .columns {
    margin-top: 55px;
  }
  h2 code, h3 code, h4 code {
    color: black;
  }
  .title-image  img {
    max-height: 300px;
  }

  /* hide banner and navbar of gt guidelines / pagexml docs */
  header[role="banner"] { display: none; }
  nav[role="toc"] { display: none; }
  footer[role="contentinfo"] { display: none; }

  /* hide stuff from sphinx docs */
  div.related[role="navigation"] { display: none; }
  div.footer[role="contentinfo"] { display: none; }

  div.footer img.footer-logo { max-height: 100px; }

  </style>
</head>
<body><nav class="navbar is-transparent is-fixed-top">

  <div class="navbar-brand">
    <a class="navbar-item" href="/">
      <img src="/assets/ocrd-logo-small.png" height="28"/>
    </a>
    <div class="navbar-burger burger" data-target="ocrd-navbar-menu">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </div>

  <div id="ocrd-navbar-menu" class="navbar-menu">
    <div class="navbar-start">
      
      
      <div class="navbar-item has-dropdown is-hoverable">
        <a class="navbar-link" href="/en/">About</a>
        <div class="navbar-dropdown">
          
          
          <a class="navbar-item" href="/en/about">The OCR-D-project</a>
          
          
          <a class="navbar-item" href="/en/contact">Get in touch!</a>
          
          
          <a class="navbar-item" href="/en/blog">Blog</a>
          
          
          <a class="navbar-item" href="/en/publications">Publications</a>
          
          
          <a class="navbar-item" href="/en/slides">Slides and presentations</a>
          
          
          <a class="navbar-item" href="/en/module-projects">Module Projects</a>
          
          
          <a class="navbar-item" href="/en/data">Data</a>
          
          
          <a class="navbar-item" href="/en/user_survey">User Survey</a>
          
          
          <a class="navbar-item" href="/en/imprint">Imprint</a>
          
        </div>
      </div>
      
      
      
      <div class="navbar-item has-dropdown is-hoverable">
        <a class="navbar-link" href="/en/dev">Developers</a>
        <div class="navbar-dropdown">
          
          
          <a class="navbar-item" href="/en/gt-guidelines/trans">Ground Truth Guidelines</a>
          
          
          <a class="navbar-item" href="/en/gt-guidelines/trans/trPage">PAGE-XML format documentation</a>
          
          
          <a class="navbar-item" href="/en/spec">Specifications</a>
          
          
          <a class="navbar-item" href="/core">OCR-D/core API Documentation</a>
          
        </div>
      </div>
      
      
      
      <div class="navbar-item has-dropdown is-hoverable">
        <a class="navbar-link" href="/en/use">Users</a>
        <div class="navbar-dropdown">
          
          
          <a class="navbar-item" href="/en/setup">Setup Guide</a>
          
          
          <a class="navbar-item" href="/en/user_guide">User Guide</a>
          
          
          <a class="navbar-item" href="/en/cookbook">Cookbook</a>
          
          
          <a class="navbar-item" href="/en/spec/glossary">Glossary</a>
          
        </div>
      </div>
      
      
      
      <a class="navbar-item" href="/en/faq">FAQ</a>
      
      

    </div>

    <div class="navbar-end">

      <span class="navbar-item">
         <a href="/de/spec/ocrd_zip.html" title="View in German">
              de
            </a> 
      </span>

    </div> </div> </nav>
<div class="columns">
      
      <aside class="column is-one-third menu">
        <ul class="menu-list column is-one-third">
  <li><a href="#ocrd-zip">OCRD-ZIP</a>
    <ul>
      <li><a href="#rationale">Rationale</a></li>
      <li><a href="#bagit-profile">BagIt profile</a>
        <ul>
          <li><a href="#bagit-profile-identifier"><code class="highlighter-rouge">BagIt-Profile-Identifier</code></a></li>
          <li><a href="#ocrd-mets"><code class="highlighter-rouge">Ocrd-Mets</code></a></li>
          <li><a href="#ocrd-manifestation-depth"><code class="highlighter-rouge">Ocrd-Manifestation-Depth</code></a></li>
          <li><a href="#ocrd-identifier"><code class="highlighter-rouge">Ocrd-Identifier</code></a></li>
          <li><a href="#ocrd-base-version-checksum"><code class="highlighter-rouge">Ocrd-Base-Version-Checksum</code></a></li>
        </ul>
      </li>
      <li><a href="#invariants">Invariants</a>
        <ul>
          <li><a href="#zip">ZIP</a></li>
          <li><a href="#manifest-sha512txt"><code class="highlighter-rouge">manifest-sha512.txt</code></a></li>
          <li><a href="#file-names-must-be-relative-to-mets">File names must be relative to METS</a>
            <ul>
              <li><a href="#example">Example</a></li>
            </ul>
          </li>
          <li><a href="#when-in-data-then-in-mets">When in data then in METS</a></li>
          <li><a href="#when-in-mets-and-not-in-data">When in METS and not in data</a></li>
        </ul>
      </li>
      <li><a href="#optional-metadata-about-the-payload">Optional metadata about the payload</a></li>
      <li><a href="#algorithms">Algorithms</a>
        <ul>
          <li><a href="#packing-a-workspace-as-ocrd-zip">Packing a workspace as OCRD-ZIP</a></li>
          <li><a href="#unpacking-ocrd-zip-to-a-workspace">Unpacking OCRD-ZIP to a workspace</a></li>
        </ul>
      </li>
      <li><a href="#appendix-a---bagit-profile-definition">Appendix A - BagIt profile definition</a></li>
      <li><a href="#appendix-b---iana-considerations">Appendix B - IANA considerations</a></li>
    </ul>
  </li>
</ul>

      </aside>
      

      <main class="container content column is-two-thirds" aria-label="Content">
        <h1 id="ocrd-zip">OCRD-ZIP</h1>

<p>This document describes an exchange format to bundle a workspace described by a
<a href="/mets">METS file following OCR-D’s conventions</a>.</p>

<h2 id="rationale">Rationale</h2>

<p>METS is the exchange format of choice by OCR-D for describing relations of
files such as images and metadata about those images such as PAGE or ALTO
files. METS is a textual format, not suitable for embedding arbitrary,
potentially binary, data. For various use cases (such as transfer via network,
long-term preservation, reproducible tests etc.) it is desirable to have a
self-contained representation of a <a href="/mets">workspace</a>.</p>

<p>With such a representation, data producers are not forced to provide
dereferenceable HTTP-URL for the files they produce and data consumers are not
forced to dereference all HTTP-URL.</p>

<p>While METS does have mechanisms for embedding XML data and even base64-encoded
binary data, the tradeoffs in file size, parsing speed and readability are too
great to make this a viable solution for a mass digitization scenario.</p>

<p>Instead, we propose an exchange format (“OCRD-ZIP”) based on the BagIt spec
used for data ingestion adopted in the web archiving community.</p>

<h2 id="bagit-profile">BagIt profile</h2>

<p>As a baseline, an OCRD-ZIP must adhere to <a href="https://tools.ietf.org/html/draft-kunze-bagit-16">v0.97+ of the BagIt
specs</a>, i.e.</p>

<ul>
  <li>all files in <code class="highlighter-rouge">data/</code></li>
  <li>a file <code class="highlighter-rouge">bagit.txt</code></li>
  <li>a file <code class="highlighter-rouge">bag-info.txt</code></li>
</ul>

<p>In accordance with the BagIt standard, <code class="highlighter-rouge">bagit.txt</code> MUST consist of exactly
these two lines:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>BagIt-Version: 1.0
Tag-File-Character-Encoding: UTF-8
</code></pre></div></div>

<p>In addition, OCRD-ZIP adhere to a <a href="https://github.com/bagit-profiles/bagit-profiles">BagIt
profile</a> (see <a href="#appendix-a">Appendix A for
the full definition</a>):</p>

<ul>
  <li><code class="highlighter-rouge">bag-info.txt</code> MUST additionally contain these tags:
    <ul>
      <li><a href="#bagit-profile-identifier"><code class="highlighter-rouge">BagIt-Profile-Identifier</code></a>: URL of the OCR-D BagIt profile</li>
      <li><a href="#ocrd-identifier"><code class="highlighter-rouge">Ocrd-Identifier</code></a>: A globally unique identifier for this bag</li>
      <li><a href="#ocrd-base-version-checksum"><code class="highlighter-rouge">Ocrd-Base-Version-Checksum</code></a>: Checksum of the version this bag is based on</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">bag-info.txt</code> MAY additionally contain these tags:
    <ul>
      <li></li>
      <li><a href="#ocrd-manifestation-depth"><code class="highlighter-rouge">Ocrd-Manifestation-Depth</code></a>: Whether all URL are dereferenced as files or only some</li>
    </ul>
  </li>
</ul>

<h3 id="bagit-profile-identifier"><code class="highlighter-rouge">BagIt-Profile-Identifier</code></h3>

<p>The <code class="highlighter-rouge">BagIt-Profile-Identifier</code> must be the string <code class="highlighter-rouge">https://ocr-d.github.io/bagit-profile.json</code>.</p>

<h3 id="ocrd-mets"><code class="highlighter-rouge">Ocrd-Mets</code></h3>

<p><code class="highlighter-rouge">Ocrd-Mets</code> can be provided to declare that the METS file will not be the
standard <code class="highlighter-rouge">mets.xml</code> but another path relative to <code class="highlighter-rouge">/data/</code>.</p>

<p>Implementations MUST check for the <code class="highlighter-rouge">Ocrd-Mets</code> tag: If it has a value, look for the
METS file at that location, relative to <code class="highlighter-rouge">/data</code>. Otherwise, assume the default
<code class="highlighter-rouge">mets.xml</code>.</p>

<h3 id="ocrd-manifestation-depth"><code class="highlighter-rouge">Ocrd-Manifestation-Depth</code></h3>

<p>Specify whether the bag contains the full manifestation of the data referenced in the METS (<code class="highlighter-rouge">full</code>)
or only those files that were <code class="highlighter-rouge">file://</code> URLs before (<code class="highlighter-rouge">partial</code>). Default: <code class="highlighter-rouge">partial</code>.</p>

<h3 id="ocrd-identifier"><code class="highlighter-rouge">Ocrd-Identifier</code></h3>

<p>A globally unique identifier identifying the work/works/parts of works this
bundle of file represents.</p>

<p>This is to be used for repositories to identify new ingestions of existing works.</p>

<p>To ensure global uniqueness, the identifier should be prefixed with an
identifier of the organization, e.g. an ISIL or domain name.</p>

<h3 id="ocrd-base-version-checksum"><code class="highlighter-rouge">Ocrd-Base-Version-Checksum</code></h3>

<p>The SHA512 checksum of the <code class="highlighter-rouge">manifest-sha512.txt</code> file of the version this bag
was based on, if any.</p>

<h2 id="invariants">Invariants</h2>

<h3 id="zip">ZIP</h3>

<p>An OCRD-ZIP MUST be a serialized as a ZIP file.</p>

<h3 id="manifest-sha512txt"><code class="highlighter-rouge">manifest-sha512.txt</code></h3>

<p>Checksums for the files in <code class="highlighter-rouge">/data</code> must be calculated with the <code class="highlighter-rouge">SHA512</code>
algorithm only and provided as <code class="highlighter-rouge">manifest-sha512.txt</code>.</p>

<p>Since the checksum of this manifest file can be relevant (see
<a href="#ocrd-base-version-checksum"><code class="highlighter-rouge">Ocrd-Base-Version-Checksum</code></a>), in addition to the requirements
of the BagIt spec, the entries MUST be sorted.</p>

<p><strong>NOTE:</strong> These checksums can be generated with <code class="highlighter-rouge">find data -type f | sort -sf |xargs sha512sum &gt; manifest-sha512.txt</code>.</p>

<h3 id="file-names-must-be-relative-to-mets">File names must be relative to METS</h3>

<p>Within an OCRD-ZIP, all local file resources referenced in the METS (and
consequently all those referenced in other files within the workspace – see
rule <a href="mets#if-in-page-then-in-mets">“If in PAGE then in METS”</a> must be
relative to the <a href="#ocrd-mets">location of the METS file</a>.</p>

<h4 id="example">Example</h4>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/tmp/foo/ws1/data
├── mets.xml
├── foo.tif
└── foo.xml
</code></pre></div></div>

<p>Valid <code class="highlighter-rouge">mets:FLocat/@xlink:href</code> in <code class="highlighter-rouge">/tmp/foo/ws1/data/mets.xml</code>:</p>
<ul>
  <li><code class="highlighter-rouge">foo.xml</code></li>
  <li><code class="highlighter-rouge">foo.tif</code></li>
  <li><code class="highlighter-rouge">file://foo.tif</code></li>
</ul>

<p>Invalid <code class="highlighter-rouge">mets:FLocat/@xlink:href</code> in <code class="highlighter-rouge">/tmp/foo/ws1/data/mets.xml</code>:</p>
<ul>
  <li><code class="highlighter-rouge">/tmp/foo/ws1/data/foo.xml</code> (absolute path)</li>
  <li><code class="highlighter-rouge">file:///tmp/foo/ws1/data/foo.tif</code> (file URL scheme with absolute path)</li>
  <li><code class="highlighter-rouge">file:///foo.tif</code> (relative path written as absolute path)</li>
</ul>

<h3 id="when-in-data-then-in-mets">When in data then in METS</h3>

<p>All files except <code class="highlighter-rouge">mets.xml</code> itself that are contained in <code class="highlighter-rouge">data</code> directory must
be referenced in a <code class="highlighter-rouge">mets:file/mets:Flocat</code> in the <code class="highlighter-rouge">mets.xml</code>.</p>

<h3 id="when-in-mets-and-not-in-data">When in METS and not in data</h3>

<p>Due to partial OCRD-ZIP not all files may be part of the payload. If so they have to be 
mentioned in fetch.txt and in all payload manifest files.</p>

<h2 id="optional-metadata-about-the-payload">Optional metadata about the payload</h2>

<p>In addition to the actual data files in <code class="highlighter-rouge">/data</code>, the following metadata files
are allowed to be present in the root of the bag:</p>

<ul>
  <li><code class="highlighter-rouge">README.md</code>: An extended, human-readable description of the dataset in the Markdown syntax</li>
  <li><code class="highlighter-rouge">Makefile</code>: A GNU make build file to reproduce the data in <code class="highlighter-rouge">/data</code>.</li>
  <li><code class="highlighter-rouge">build.sh</code>: A bash script to reproduce the data in <code class="highlighter-rouge">/data</code>.</li>
  <li><code class="highlighter-rouge">sources.csv</code>: A comma-separated values list to be used in the scripts. For straightforward HTTP downloads, prefer <a href="https://tools.ietf.org/html/rfc8493#section-2.2.3">fetch.txt</a>.</li>
</ul>

<p>These files are purely for documentation and should not be used by processors in any way.</p>

<h2 id="algorithms">Algorithms</h2>

<h3 id="packing-a-workspace-as-ocrd-zip">Packing a workspace as OCRD-ZIP</h3>

<p>To pack a workspace to OCRD-ZIP:</p>

<ul>
  <li>Create a temporary folder <code class="highlighter-rouge">TMP</code></li>
  <li>Foreach <code class="highlighter-rouge">mets:file</code> <code class="highlighter-rouge">f</code> in the source METS:
    <ul>
      <li>Strip <code class="highlighter-rouge">file://</code> from the beginning of the <code class="highlighter-rouge">xlink:href</code> of <code class="highlighter-rouge">f</code></li>
      <li>If it is not a file path (begins with <code class="highlighter-rouge">http://</code> or <code class="highlighter-rouge">https://</code>):
        <ul>
          <li>If <code class="highlighter-rouge">Ocrd-Manifestation-Depth</code> is <code class="highlighter-rouge">partial</code>,
continue</li>
        </ul>
      </li>
      <li>Download/Copy the file to a location within <code class="highlighter-rouge">TMP/data</code>. The structure SHOULD be <code class="highlighter-rouge">&lt;USE&gt;/&lt;ID&gt;</code> where
        <ul>
          <li><code class="highlighter-rouge">&lt;USE&gt;</code> is the <code class="highlighter-rouge">USE</code> attribute of the parent <code class="highlighter-rouge">mets:fileGrp</code></li>
          <li><code class="highlighter-rouge">&lt;ID&gt;</code> is the <code class="highlighter-rouge">ID</code> attribute of the <code class="highlighter-rouge">mets:file</code></li>
        </ul>
      </li>
      <li>Replace the URL of <code class="highlighter-rouge">f</code> with the path relative to <code class="highlighter-rouge">/data</code> (SHOULD be <code class="highlighter-rouge">&lt;USE&gt;/&lt;ID&gt;</code>) in
        <ul>
          <li>all <code class="highlighter-rouge">mets:FLocat</code> of the METS</li>
          <li>all other files in the workspace, esp. PAGE-XML</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Write out the changed METS to <code class="highlighter-rouge">TMP/data/mets.xml</code></li>
  <li>Package <code class="highlighter-rouge">TMP</code> as a BagIt bag</li>
</ul>

<h3 id="unpacking-ocrd-zip-to-a-workspace">Unpacking OCRD-ZIP to a workspace</h3>

<ul>
  <li>Unzip OCRD-ZIP <code class="highlighter-rouge">z</code> to a folder <code class="highlighter-rouge">TMP</code></li>
  <li>If the value <code class="highlighter-rouge">M</code> of <a href="#ocrd-mets"><code class="highlighter-rouge">Ocrd-Mets</code></a> is different from <code class="highlighter-rouge">mets.xml</code>:
    <ul>
      <li>Rename <code class="highlighter-rouge">TMP/data/mets.xml</code> to <code class="highlighter-rouge">TMP/data/</code> + <code class="highlighter-rouge">M</code></li>
    </ul>
  </li>
  <li>Move <code class="highlighter-rouge">TMP/data</code> to an appropriate location to use as a workspace</li>
</ul>

<h2 id="appendix-a---bagit-profile-definition">Appendix A - BagIt profile definition</h2>

<!-- BEGIN-EVAL -w '```yaml' '```' -- cat ./bagit-profile.yml  -->
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">BagIt-Profile-Info</span><span class="pi">:</span>
  <span class="na">BagIt-Profile-Identifier</span><span class="pi">:</span> <span class="s">https://ocr-d.github.io/bagit-profile.json</span>
  <span class="na">BagIt-Profile-Version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">1.2.0'</span>
  <span class="na">Source-Organization</span><span class="pi">:</span> <span class="s">OCR-D</span>
  <span class="na">External-Description</span><span class="pi">:</span> <span class="s">BagIt profile for OCR data</span>
  <span class="na">Contact-Name</span><span class="pi">:</span> <span class="s">Konstantin Baierer</span>
  <span class="na">Contact-Email</span><span class="pi">:</span> <span class="s">konstantin.baierer@sbb.spk-berlin.de</span>
  <span class="na">Version</span><span class="pi">:</span> <span class="m">0.1</span>
<span class="na">Bag-Info</span><span class="pi">:</span>
  <span class="na">Bagging-Date</span><span class="pi">:</span>
    <span class="na">required</span><span class="pi">:</span> <span class="no">false</span>
  <span class="na">Source-Organization</span><span class="pi">:</span>
    <span class="na">required</span><span class="pi">:</span> <span class="no">false</span>
  <span class="na">Ocrd-Mets</span><span class="pi">:</span>
    <span class="na">required</span><span class="pi">:</span> <span class="no">false</span>
    <span class="na">default</span><span class="pi">:</span> <span class="s1">'</span><span class="s">mets.xml'</span>
  <span class="na">Ocrd-Manifestation-Depth</span><span class="pi">:</span>
    <span class="na">required</span><span class="pi">:</span> <span class="no">false</span>
    <span class="na">default</span><span class="pi">:</span> <span class="s">partial</span>
    <span class="na">values</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">partial"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">full"</span><span class="pi">]</span>
  <span class="na">Ocrd-Identifier</span><span class="pi">:</span>
    <span class="na">required</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">Ocrd-Checksum</span><span class="pi">:</span>
    <span class="na">required</span><span class="pi">:</span> <span class="no">false</span>
    <span class="c1"># echo -n | sha512sum</span>
    <span class="na">default</span><span class="pi">:</span> <span class="s1">'</span><span class="s">cf83e1357eefb8bdf1542850d66d8007d620e4050b5715dc83f4a921d36ce9ce47d0d13c5d85f2b0ff8318d2877eec2f63b931bd47417a81a538327af927da3e'</span>
<span class="na">Manifests-Required</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">sha512'</span><span class="pi">]</span>
<span class="na">Tag-Manifests-Required</span><span class="pi">:</span> <span class="pi">[]</span>
<span class="na">Tag-Files-Required</span><span class="pi">:</span> <span class="pi">[]</span>
<span class="na">Tag-Files-Allowed</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">README.md</span>
  <span class="pi">-</span> <span class="s">Makefile</span>
  <span class="pi">-</span> <span class="s">build.sh</span>
  <span class="pi">-</span> <span class="s">sources.csv</span>
  <span class="pi">-</span> <span class="s">metadata/*.xml</span>
  <span class="pi">-</span> <span class="s">metadata/*.txt</span>
<span class="s">Allow-Fetch.txt</span><span class="pi">:</span> <span class="no">true</span>
<span class="na">Serialization</span><span class="pi">:</span> <span class="s">required</span>
<span class="na">Accept-Serialization</span><span class="pi">:</span> <span class="s">application/zip</span>
<span class="na">Accept-BagIt-Version</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s1">'</span><span class="s">1.0'</span>
</code></pre></div></div>

<!-- END-EVAL -->

<h2 id="appendix-b---iana-considerations">Appendix B - IANA considerations</h2>

<p>Proposed media type of OCRD-ZIP: <code class="highlighter-rouge">application/vnd.ocrd+zip</code></p>

<p>Proposed extension: <code class="highlighter-rouge">.ocrd.zip</code></p>


      </main>
    </div><footer class="footer" style="padding: 1rem">
    <div class="content has-text-centered">
      <a href="https://github.com/OCR-D">GitHub</a>
      |
      <a href="https://gitter.im/OCR-D/Lobby">gitter</a>
      |
      <a href="https://hub.docker.com/u/ocrd">Docker Hub</a>
      |
      <a href="/sitemap.xml">sitemap.xml</a>
      |
      <img class="footer-logo" src="/assets/dfg_logo_eng.jpg" alt="DFG logo"/>
    </div>

<script src="/assets/script.js"></script>
</footer>
</body>

</html>
