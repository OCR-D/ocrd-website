<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8"/>
  <title>Web Api - OCR-D</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="shortcut icon" href="https://avatars0.githubusercontent.com/u/26362587?s=200&amp;v=4" />
  <link href="/assets/font-awesome.min.css" rel="stylesheet" crossorigin="anonymous" />
  <link rel="alternate" type="application/atom+xml" title="OCR-D Blog" href="/feed.xml" />
  <link rel="stylesheet" href="/assets/bulma.css" />
  <link rel="stylesheet" href="/assets/bulma-switch.min.css" />
  <link rel="stylesheet" href="/assets/syntax-highlight.css" />
  <link rel="stylesheet" href="/assets/ocrd.css" />
  <!-- for mathjax support -->
  <script type="text/javascript">
    const getSiblings = function (elem) {

      // Setup siblings array and get the first sibling
      const siblings = [];
      let sibling = elem.parentNode.firstChild;

      // Loop through each sibling and push to the array
      while (sibling) {
        if ((sibling.nodeType === 1 || sibling.nodeType === 3) && sibling !== elem) {
          siblings.push(sibling);
        }
        sibling = sibling.nextSibling
      }

      return siblings;
    };

    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['$$', '$$']],
        processEscapes: true,
      },
      startup: {
        ready: () => {
          MathJax.startup.defaultReady();
          MathJax.startup.promise.then(() => {
            const equations = document.querySelectorAll('.MathJax');

            if (equations.length === 0) return;

            equations.forEach(eq => {
              const siblings = getSiblings(eq);
              if (siblings.length === 0) {
                eq.classList.add('is-block');
              }
            })
          });
        }
      }
    }
  </script>
  <script type="text/javascript" id="MathJax-script" async src="/assets/mathjax/es5/tex-chtml.js">
  </script>
</head>
<body>
<script async src="https://cse.google.com/cse.js?cx=e9e3f7148e57ed66c"></script>


<script>
function ToggleSearchActive2() {
    var T = document.getElementById("button-header")
	var A = document.getElementById("google-search-header");
    T.style.display = "none";  // <-- Set it to none
	A.style.visibility = "visible";  // <-- Set it to visible
}
</script>


<nav class="navbar is-transparent is-fixed-top">

  <div class="navbar-brand">
    <a class="navbar-item" href="/">
      <img src="/assets/ocrd-logo-small.png" height="28"/>
    </a>
    <div class="navbar-burger burger" data-target="ocrd-navbar-menu">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </div>

  <div id="ocrd-navbar-menu" class="navbar-menu">
    <div class="navbar-start">
      
      
      <div class="navbar-item has-dropdown is-hoverable">
        <a class="navbar-link" href="/en/">About</a>
        <div class="navbar-dropdown">
          

          
          

            
            <a class="navbar-item" href="/en/blog">News</a>

          

          

          
          

            
            <a class="navbar-item" href="/en/about">About the OCR-D Project</a>

          

          

          
          

            
            <a class="navbar-item" href="/en/phase2">Phase II: Projects</a>

          

          

          
          

            
            <a class="navbar-item" href="/en/phase3">Phase III: Projects</a>

          

          

          
          

            
            <a class="navbar-item" href="/en/community">Community</a>

          

          

          
          
            
            
              
              <a class="navbar-item" href="/en/publications">Publications and Presentations</a>
            

          

          

          
          
            
            
              
              <a class="navbar-item" href="/en/data">Data</a>
            

          

          

          
          
            
            
              
              <a class="navbar-item" href="/en/initial-tests">Pilot Study</a>
            

          

          

          
          
            
            
              
              <a class="navbar-item" href="/en/survey">User Survey</a>
            

          

          

          
          
            
            
              
              <a class="navbar-item" href="/en/contact">Contacts</a>
            

          

          

          
          
            
            
              
              <a class="navbar-item" href="/en/imprint">Imprint</a>
            

          

          
        </div>
      </div>
      

      
      
      <div class="navbar-item has-dropdown is-hoverable">
        <a class="navbar-link" href="/en/dev">Technical Resources</a>
        <div class="navbar-dropdown">
          

          
          

            
            <a class="navbar-item" href="/en/decisions">Decision Log</a>

          

          

          
          

            
            <a class="navbar-item" href="/en/gt-guidelines/trans">Ground Truth Guidelines</a>

          

          

          
          

            
            <a class="navbar-item" href="/en/gt-guidelines/trans/trPage">PAGE-XML format documentation</a>

          

          

          
          

            
            <a class="navbar-item" href="/en/dev-best-practice">OCR-D development best practices</a>

          

          

          
          

            
            <a class="navbar-item" href="/en/spec">Specifications</a>

          

          

          
          

            
            <a class="navbar-item" href="/core">OCR-D/core API Documentation</a>

          

          
        </div>
      </div>
      

      
      
      <div class="navbar-item has-dropdown is-hoverable">
        <a class="navbar-link" href="/en/use">User Guides & Info</a>
        <div class="navbar-dropdown">
          

          
          
            
            
              
              <a class="navbar-item" href="/en/start">Quick Start Guide</a>
            

          

          

          
          
            
            
              
              <a class="navbar-item" href="/en/setup">Setup Guide</a>
            

          

          

          
          
            
            
              
              <a class="navbar-item" href="/en/user_guide">User Guide</a>
            

          

          

          
          
            
            
              
              <a class="navbar-item" href="/en/workflows">Workflows</a>
            

          

          

          
          

            
            <a class="navbar-item" href="/en/models">Models</a>

          

          

          
          

            
            <a class="navbar-item" href="/quiver-frontend">QUIVER (Quality assurance)</a>

          

          

          
          

            
            <a class="navbar-item" href="/en/spec/glossary">Glossary</a>

          

          
        </div>
      </div>
      

      
      
        <a class="navbar-item" href="/en/faq">FAQ</a>
      

      
	 <span class="navbar-item">
	 
            <a href="" title="View in German"></a>
				<div class="navbar-item has-dropdown is-hoverable" style="padding-right:10px">Search
				<div class="navbar-dropdown" style="font-size: 0.75em; padding:5px">For this feature, we implemented Google Programmable Search Engine. 
					If you use it, please note that cookies may be stored and Privacy Policy by Google LLC applies: 
					<a href="https://policies.google.com/privacy">https://policies.google.com/privacy</a> 
					<button onclick="ToggleSearchActive2()" id="button-header">Agree, show me Google Search!</button></div>
				</div>
				<div id="google-search-header" style="visibility: hidden">
					<div class="gcse-search"></div>
				</div>
			
	</span>
    </div>

    <div class="navbar-end">

      <span class="navbar-item">
        </span>


    </div> </div> </nav>
<div class="wrapper has-toc">
      
      <aside id="toc-sidebar">
        <div id="toc-sidebar-toggle">
          <a class="button is-outlined is-link" title="
          Toggle Table of Contents
          
        ">
            <i class="fa"></i>
          </a>
        </div>
        <div class="toc-wrapper">
          <div class="toc-header">
            <h2>
              Table of Contents
              
            </h2>
          </div>
          <div class="toc-body">
            <ul class="menu-list">
  <li><a href="#nextflow">Nextflow</a>
    <ul>
      <li><a href="#what-is-nf-and-why-did-we-choose-it">What is NF and why did we choose it?</a></li>
      <li><a href="#how-is-the-nf-script-structured">How is the NF script structured?</a>
        <ul>
          <li><a href="#dsl-and-parameters">DSL and Parameters</a></li>
          <li><a href="#definition-of-processes">Definition of processes</a></li>
          <li><a href="#definition-of-workflows">Definition of workflows</a></li>
          <li><a href="#main-workflow">Main workflow</a></li>
        </ul>
      </li>
      <li><a href="#which-features-of-nf-do-we-use-ie-what-features-have-to-be-implemented-in-potential-implementations">Which features of NF do we use, i.e. what features have to be implemented in potential implementations?</a></li>
      <li><a href="#how-does-parallelization-work-both-within-works-and-across-works">How does parallelization work, both within works and across works?</a></li>
      <li><a href="#how-does-the-nf-script-interact-with-the-processing-server">How does the NF script interact with the processing server?</a></li>
      <li><a href="#how-does-the-nf-script-interact-with-the-mets-server">How does the NF script interact with the METS server?</a></li>
      <li><a href="#how-to-convert-the-existing-ocr-d-process-workflows-we-reference-to-nf">How to convert the existing OCR-D process workflows we reference to NF?</a></li>
      <li><a href="#how-should-nf-scripts-be-written-tested-deployed-and-evaluated">How should NF scripts be written, tested, deployed, and evaluated?</a></li>
      <li><a href="#what-conventions-do-we-encourage-naming-structure-documentation-etc">What conventions do we encourage, naming, structure, documentation, etc.?</a></li>
    </ul>
  </li>
</ul>

          </div>
        </div>
      </aside>
      

      <main class="container content " aria-label="Content">
        <h1 id="nextflow">Nextflow</h1>

<h2 id="what-is-nf-and-why-did-we-choose-it">What is NF and why did we choose it?</h2>

<p>Nextflow is a workflow framework that allows the integration of various scripting languages into a single cohesive pipeline. Nextflow also has its own Domain Specific Language (DSL) that extends Groovy (extension of Java).</p>

<p>We choose it due to its rich set of features:</p>
<ul>
  <li>Stream oriented: Promotes programming approach extending Unix pipes model.</li>
  <li>Fast Prototyping: Let’s you write a computational pipeline from smaller tasks.</li>
  <li>Reproducibility: Supports Docker, Singularity, and 3 other types of containers.</li>
  <li>Portable: Can run locally, Slurm, SGE, PBS, and cloud (Google, Kubernetes, and AWS).</li>
  <li>Continuous checkpoints: Each process in the workflow is checkpointed. It is possible to retry 
failed workflows and start from the last checkpoint.</li>
  <li>Supports various scripting languages including Bash, Python, Perl, and others.</li>
  <li>Enables separation between configuration (how to do) and workflow logic (what to do).</li>
  <li>Modularization of tasks possible via workflow, sub-workflows, and processes.</li>
  <li>Provides detailed logs and various types of execution reports.</li>
</ul>

<h2 id="how-is-the-nf-script-structured">How is the NF script structured?</h2>

<p>The NF script contains the following structures:</p>
<h3 id="dsl-and-parameters">DSL and Parameters</h3>
<h3 id="definition-of-processes">Definition of processes</h3>
<h3 id="definition-of-workflows">Definition of workflows</h3>
<h3 id="main-workflow">Main workflow</h3>

<p>Check this source code example: <a href="https://github.com/MehmedGIT/OPERANDI_TestRepo/blob/master/ExampleWorkflows/Nextflow/workflow4/seq_ocrd_wf_many.nf">seq_ocrd_wf_many.nf</a></p>

<p>TODO: I will provide more structure-related details here based on the example above.</p>

<h2 id="which-features-of-nf-do-we-use-ie-what-features-have-to-be-implemented-in-potential-implementations">Which features of NF do we use, i.e. what features have to be implemented in potential implementations?</h2>
<p>The minimally used features for local runs are the parameters, processes, process decorators, and workflows. I will provide further answers to any following questions related to this main question. I am not sure what else to cover here for now.</p>

<h2 id="how-does-parallelization-work-both-within-works-and-across-works">How does parallelization work, both within works and across works?</h2>

<p>A Nextflow workflow script contains several processes. Processes are executed independently and are isolated from each other (i.e. they do not have a shared memory space). Communication between the processes is possible only through data channels (similar to the pipes model in Unix). These channels are basically asynchronous FIFO queues. Any process can define one or more channels as input and output. The order of interaction between these processes, and ultimately the order of workflow execution depends on the communication channel dependencies between processes. For example, if process A writes data to channel A and process B reads data from channel A, then Nextflow knows that process A must be executed before process B.</p>

<p>Check this source code example: <a href="https://github.com/MehmedGIT/OPERANDI_TestRepo/blob/master/ExampleWorkflows/Nextflow/workflow4/seq_ocrd_wf_many.nf">seq_ocrd_wf_many.nf</a></p>

<p>TODO: I will provide more parallelization details here based on the example above.</p>

<h2 id="how-does-the-nf-script-interact-with-the-processing-server">How does the NF script interact with the processing server?</h2>
<p>There is still no running processing server. More details will be announced once there is more to talk about. The interaction will most probably happen with curl through a bash script inside the Nextflow process. Of course, if it is integrated inside the OCR-D core, then no direct interactions will be needed from inside the Nextflow script.</p>

<h2 id="how-does-the-nf-script-interact-with-the-mets-server">How does the NF script interact with the METS server?</h2>
<p>There is still no running METS server. More details will be announced once there is more to talk about. The interaction will most probably happen with curl through a bash script inside the Nextflow process. Of course, if it is integrated inside the OCR-D core, then no direct interactions will be needed from inside the Nextflow script.</p>

<h2 id="how-to-convert-the-existing-ocr-d-process-workflows-we-reference-to-nf">How to convert the existing OCR-D process workflows we reference to NF?</h2>
<p>I have written an OtoN (OCR-D to Nextflow) converter which converts basic OCR-D process workflows to Nextflow workflow scripts. Check here: <a href="https://github.com/MehmedGIT/OtoN_Converter">OtoN</a></p>

<p>Currently, there are no known issues or bugs. Feel free to report any bugs, errors, or lack of errors (when an error is expected). 
The tool will probably be a part of the OCR-D software in the future when it is stable enough for general use.</p>

<h2 id="how-should-nf-scripts-be-written-tested-deployed-and-evaluated">How should NF scripts be written, tested, deployed, and evaluated?</h2>
<p>Depends on the use case. Detailed instructions for local executions and example Nextflow workflow scripts can be found here: <a href="https://github.com/MehmedGIT/OPERANDI_TestRepo/tree/master/ExampleWorkflows/Nextflow">Nextflow</a></p>

<p>I will provide further answers to any following questions related to this main question.</p>

<h2 id="what-conventions-do-we-encourage-naming-structure-documentation-etc">What conventions do we encourage, naming, structure, documentation, etc.?</h2>
<p>Try to stick to the structure provided in point 2 when writing Nextflow scripts. You can also check the Nextflow examples provided in point 8. The naming conventions for variables, function names, process names, and workflow names are encouraged to follow the snake case. I will provide further answers to any following questions related to this main question.</p>

      </main>
    </div><footer class="footer" style="padding: 1rem">
    <div class="content has-text-centered">
      <img class="footer-logo" src="/assets/dfg_logo_eng.jpg" alt="DFG logo"/>
    </div>
    <!-- <div class="content has-text-centered"> -->
    <!--   <img class="footer-logo" src="/assets/logo-bbaw.png" alt="BBAW logo"/> -->
    <!--   <img class="footer-logo" src="/assets/logo-hab.gif" alt="HAB logo"/> -->
    <!--   <img class="footer-logo" src="/assets/logo-kit.png" alt="KIT logo"/> -->
    <!--   <img class="footer-logo" src="/assets/logo-sbb.png" alt="SBB logo"/> -->
    <!-- </div> -->
    <div class="content has-text-centered">
		<a href="https://github.com/OCR-D">GitHub</a>
		|
		<a href="https://gitter.im/OCR-D/Lobby">Gitter</a>
		|
		<a href="https://github.com/OCR-D/ocrd-website/wiki">Wiki</a>
    |
		<a href="https://ocr-d.de/quiver-frontend">Quiver</a>
		|
		<a href="https://hub.docker.com/u/ocrd">Docker Hub</a>
		|
		<a href="https://www.zotero.org/groups/418719/ocr-d">Technology Watch</a>
		|
		<a href="/sitemap.xml">sitemap.xml</a>
		|
		
			<a href="/en/imprint">Imprint</a>
		
    </div>

<script src="/assets/script.js"></script>
</footer>
</body>

</html>
